import{_ as m,a1 as ne,a2 as ie,a3 as vt,a4 as b,a5 as re,a6 as Bt,a7 as oe,a8 as ae,a9 as J,aa as ce,ab as he,ac as le,ad as Ft,ae as ue,af as Wt,ag as de,ah as fe,ai as me,aj as pe,ak as ge,al as xt,am as ye,an as st,ao as Gt,ap as _e,aq as ve,ar as xe,as as Te,at as Me,au as be,av as Q,aw as Se,ax as nt,ay as Ce,az as Ee,aA as Ae,O as it,v as we,z as Le,B as Oe,D as Re,G as Ie,aB as tt,u as Zt,aC as p,aD as Pe,aE as ot,aF as Y,aG as Tt,C as Ne,aH as ze}from"./settings-cc329b7d.js";import{G as qe}from"./index-37f17cc4.js";function Mt(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();n=t[0]*1e3+t[1]/1e6}else n=Date.now();return n}class bt{constructor(t,e){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Mt(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Mt()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class De{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:s}=t;let i=this.stats[e];return i||(t instanceof bt?i=t:i=new bt(e,s),this.stats[e]=i),i}}const Ue="Queued Requests",Ve="Active Requests",ke="Cancelled Requests",Be="Queued Requests Ever",Fe="Active Requests Ever",We={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Ge{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m(this,"props",void 0),m(this,"stats",void 0),m(this,"activeRequestCount",0),m(this,"requestQueue",[]),m(this,"requestMap",new Map),m(this,"deferredUpdate",null),this.props={...We,...t},this.stats=new De({id:this.props.id}),this.stats.get(Ue),this.stats.get(Ve),this.stats.get(ke),this.stats.get(Be),this.stats.get(Fe)}scheduleRequest(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const s={handle:t,priority:0,getPriority:e},i=new Promise(r=>(s.resolve=r,s));return this.requestQueue.push(s),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:s}=t;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const s=t[e];this._updateRequest(s)||(t.splice(e,1),this.requestMap.delete(s.handle),e--)}t.sort((e,s)=>e.priority-s.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let B;class dt extends ne{static get ZERO(){return B||(B=new dt(0,0,0,0),Object.freeze(B)),B}constructor(t=0,e=0,s=0,i=0){super(-0,-0,-0,-0),ie(t)&&arguments.length===1?this.copy(t):(vt.debug&&(b(t),b(e),b(s),b(i)),this[0]=t,this[1]=e,this[2]=s,this[3]=i)}set(t,e,s,i){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return vt.debug&&(b(t.x),b(t.y),b(t.z),b(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=b(t)}get w(){return this[3]}set w(t){this[3]=b(t)}transform(t){return re(this,this,t),this.check()}transformByMatrix3(t){return Bt(this,this,t),this.check()}transformByMatrix2(t){return oe(this,this,t),this.check()}transformByQuaternion(t){return ae(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}function Ze(){var n=new J(9);return J!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function je(n,t){if(n===t){var e=t[1],s=t[2],i=t[5];n[1]=t[3],n[2]=t[6],n[3]=e,n[5]=t[7],n[6]=s,n[7]=i}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n}function $e(n,t){var e=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=l*o-a*h,d=-l*r+a*c,f=h*r-o*c,g=e*u+s*d+i*f;return g?(g=1/g,n[0]=u*g,n[1]=(-l*s+i*h)*g,n[2]=(a*s-i*o)*g,n[3]=d*g,n[4]=(l*e-i*c)*g,n[5]=(-a*e+i*r)*g,n[6]=f*g,n[7]=(-h*e+s*c)*g,n[8]=(o*e-s*r)*g,n):null}function Xe(n){var t=n[0],e=n[1],s=n[2],i=n[3],r=n[4],o=n[5],a=n[6],c=n[7],h=n[8];return t*(h*r-o*c)+e*(-h*i+o*a)+s*(c*i-r*a)}function St(n,t,e){var s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=e[0],f=e[1],g=e[2],y=e[3],_=e[4],v=e[5],M=e[6],A=e[7],C=e[8];return n[0]=d*s+f*o+g*h,n[1]=d*i+f*a+g*l,n[2]=d*r+f*c+g*u,n[3]=y*s+_*o+v*h,n[4]=y*i+_*a+v*l,n[5]=y*r+_*c+v*u,n[6]=M*s+A*o+C*h,n[7]=M*i+A*a+C*l,n[8]=M*r+A*c+C*u,n}function Qe(n,t,e){var s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=e[0],f=e[1];return n[0]=s,n[1]=i,n[2]=r,n[3]=o,n[4]=a,n[5]=c,n[6]=d*s+f*o+h,n[7]=d*i+f*a+l,n[8]=d*r+f*c+u,n}function Ye(n,t,e){var s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=Math.sin(e),f=Math.cos(e);return n[0]=f*s+d*o,n[1]=f*i+d*a,n[2]=f*r+d*c,n[3]=f*o-d*s,n[4]=f*a-d*i,n[5]=f*c-d*r,n[6]=h,n[7]=l,n[8]=u,n}function Ct(n,t,e){var s=e[0],i=e[1];return n[0]=s*t[0],n[1]=s*t[1],n[2]=s*t[2],n[3]=i*t[3],n[4]=i*t[4],n[5]=i*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function He(n,t){var e=t[0],s=t[1],i=t[2],r=t[3],o=e+e,a=s+s,c=i+i,h=e*o,l=s*o,u=s*a,d=i*o,f=i*a,g=i*c,y=r*o,_=r*a,v=r*c;return n[0]=1-u-g,n[3]=l-v,n[6]=d+_,n[1]=l+v,n[4]=1-h-g,n[7]=f-y,n[2]=d-_,n[5]=f+y,n[8]=1-h-u,n}var at;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(at||(at={}));const Ke=Object.freeze([1,0,0,0,1,0,0,0,1]);class x extends ce{static get IDENTITY(){return ts()}static get ZERO(){return Je()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return at}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Ke)}fromObject(t){return this.check()}fromQuaternion(t){return He(this,t),this.check()}set(t,e,s,i,r,o,a,c,h){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this[4]=r,this[5]=o,this[6]=a,this[7]=c,this[8]=h,this.check()}setRowMajor(t,e,s,i,r,o,a,c,h){return this[0]=t,this[1]=i,this[2]=a,this[3]=e,this[4]=r,this[5]=c,this[6]=s,this[7]=o,this[8]=h,this.check()}determinant(){return Xe(this)}transpose(){return je(this,this),this.check()}invert(){return $e(this,this),this.check()}multiplyLeft(t){return St(this,t,this),this.check()}multiplyRight(t){return St(this,this,t),this.check()}rotate(t){return Ye(this,this,t),this.check()}scale(t){return Array.isArray(t)?Ct(this,this,t):Ct(this,this,[t,t]),this.check()}translate(t){return Qe(this,this,t),this.check()}transform(t,e){let s;switch(t.length){case 2:s=le(e||[-0,-0],t,this);break;case 3:s=he(e||[-0,-0,-0],t,this);break;case 4:s=Bt(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ft(s,t.length),s}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let F,W;function Je(){return F||(F=new x([0,0,0,0,0,0,0,0,0]),Object.freeze(F)),F}function ts(){return W||(W=new x,Object.freeze(W)),W}function Et(){var n=new J(4);return J!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function es(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function jt(n,t,e){e=e*.5;var s=Math.sin(e);return n[0]=s*t[0],n[1]=s*t[1],n[2]=s*t[2],n[3]=Math.cos(e),n}function At(n,t,e){var s=t[0],i=t[1],r=t[2],o=t[3],a=e[0],c=e[1],h=e[2],l=e[3];return n[0]=s*l+o*a+i*h-r*c,n[1]=i*l+o*c+r*a-s*h,n[2]=r*l+o*h+s*c-i*a,n[3]=o*l-s*a-i*c-r*h,n}function ss(n,t,e){e*=.5;var s=t[0],i=t[1],r=t[2],o=t[3],a=Math.sin(e),c=Math.cos(e);return n[0]=s*c+o*a,n[1]=i*c+r*a,n[2]=r*c-i*a,n[3]=o*c-s*a,n}function ns(n,t,e){e*=.5;var s=t[0],i=t[1],r=t[2],o=t[3],a=Math.sin(e),c=Math.cos(e);return n[0]=s*c-r*a,n[1]=i*c+o*a,n[2]=r*c+s*a,n[3]=o*c-i*a,n}function is(n,t,e){e*=.5;var s=t[0],i=t[1],r=t[2],o=t[3],a=Math.sin(e),c=Math.cos(e);return n[0]=s*c+i*a,n[1]=i*c-s*a,n[2]=r*c+o*a,n[3]=o*c-r*a,n}function rs(n,t){var e=t[0],s=t[1],i=t[2];return n[0]=e,n[1]=s,n[2]=i,n[3]=Math.sqrt(Math.abs(1-e*e-s*s-i*i)),n}function H(n,t,e,s){var i=t[0],r=t[1],o=t[2],a=t[3],c=e[0],h=e[1],l=e[2],u=e[3],d,f,g,y,_;return f=i*c+r*h+o*l+a*u,f<0&&(f=-f,c=-c,h=-h,l=-l,u=-u),1-f>ve?(d=Math.acos(f),g=Math.sin(d),y=Math.sin((1-s)*d)/g,_=Math.sin(s*d)/g):(y=1-s,_=s),n[0]=y*i+_*c,n[1]=y*r+_*h,n[2]=y*o+_*l,n[3]=y*a+_*u,n}function os(n,t){var e=t[0],s=t[1],i=t[2],r=t[3],o=e*e+s*s+i*i+r*r,a=o?1/o:0;return n[0]=-e*a,n[1]=-s*a,n[2]=-i*a,n[3]=r*a,n}function as(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n}function $t(n,t){var e=t[0]+t[4]+t[8],s;if(e>0)s=Math.sqrt(e+1),n[3]=.5*s,s=.5/s,n[0]=(t[5]-t[7])*s,n[1]=(t[6]-t[2])*s,n[2]=(t[1]-t[3])*s;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var r=(i+1)%3,o=(i+2)%3;s=Math.sqrt(t[i*3+i]-t[r*3+r]-t[o*3+o]+1),n[i]=.5*s,s=.5/s,n[3]=(t[r*3+o]-t[o*3+r])*s,n[r]=(t[r*3+i]+t[i*3+r])*s,n[o]=(t[o*3+i]+t[i*3+o])*s}return n}var cs=ue,hs=Wt,ls=de,us=fe,ds=me,fs=pe,Xt=xe,ms=function(){var n=ge(),t=xt(1,0,0),e=xt(0,1,0);return function(s,i,r){var o=ye(i,r);return o<-.999999?(st(n,t,i),Gt(n)<1e-6&&st(n,e,i),_e(n,n),jt(s,n,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(st(n,i,r),s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=1+o,Xt(s,s))}}();(function(){var n=Et(),t=Et();return function(e,s,i,r,o,a){return H(n,s,o,a),H(t,i,r,a),H(e,n,t,2*a*(1-a)),e}})();(function(){var n=Ze();return function(t,e,s,i){return n[0]=s[0],n[3]=s[1],n[6]=s[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],Xt(t,$t(t,n))}})();const ps=[0,0,0,1];class wt extends Te{constructor(t=0,e=0,s=0,i=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,s,i)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,s,i){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return $t(this,t),this.check()}fromAxisRotation(t,e){return jt(this,t,e),this.check()}identity(){return es(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=b(t)}get y(){return this[1]}set y(t){this[1]=b(t)}get z(){return this[2]}set z(t){this[2]=b(t)}get w(){return this[3]}set w(t){this[3]=b(t)}len(){return ds(this)}lengthSquared(){return fs(this)}dot(t){return ls(this,t)}rotationTo(t,e){return ms(this,t,e),this.check()}add(t){return cs(this,this,t),this.check()}calculateW(){return rs(this,this),this.check()}conjugate(){return as(this,this),this.check()}invert(){return os(this,this),this.check()}lerp(t,e,s){return s===void 0?this.lerp(this,t,e):(us(this,t,e,s),this.check())}multiplyRight(t){return At(this,this,t),this.check()}multiplyLeft(t){return At(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return ss(this,this,t),this.check()}rotateY(t){return ns(this,this,t),this.check()}rotateZ(t){return is(this,this,t),this.check()}scale(t){return hs(this,this,t),this.check()}slerp(t,e,s){let i,r,o;switch(arguments.length){case 1:({start:i=ps,target:r,ratio:o}=t);break;case 2:i=this,r=t,o=e;break;default:i=t,r=e,o=s}return H(this,i,r,o),this.check()}transformVector4(t,e=new dt){return Me(e,t,this),Ft(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const Qt={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},G=Math.PI/180,Lt=180/Math.PI,K=6370972,N=256;function gs(){const n=N/K,t=Math.PI/180*N;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[t,t,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/n]}}class ys extends be{constructor(t={}){const{latitude:e=0,longitude:s=0,zoom:i=0,nearZMultiplier:r=.1,farZMultiplier:o=2,resolution:a=10}=t;let{height:c,altitude:h=1.5}=t;c=c||1,h=Math.max(.75,h);const l=new Q().lookAt({eye:[0,-h,0],up:[0,0,1]}),u=Math.pow(2,i);l.rotateX(e*G),l.rotateZ(-s*G),l.scale(u/c);const d=Math.atan(.5/h),f=N*2*u/c;super({...t,height:c,viewMatrix:l,longitude:s,latitude:e,zoom:i,distanceScales:gs(),fovyRadians:d*2,focalDistance:h,near:r,far:Math.min(2,1/f+1)*h*o}),m(this,"longitude",void 0),m(this,"latitude",void 0),m(this,"resolution",void 0),this.latitude=e,this.longitude=s,this.resolution=a}get projectionMode(){return Se.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const e={targetZ:t.z||0},s=this.unproject([0,this.height/2],e),i=this.unproject([this.width/2,0],e),r=this.unproject([this.width,this.height/2],e),o=this.unproject([this.width/2,this.height],e);return r[0]<this.longitude&&(r[0]+=360),s[0]>this.longitude&&(s[0]-=360),[Math.min(s[0],r[0],i[0],o[0]),Math.min(s[1],r[1],i[1],o[1]),Math.max(s[0],r[0],i[0],o[0]),Math.max(s[1],r[1],i[1],o[1])]}unproject(t,{topLeft:e=!0,targetZ:s}={}){const[i,r,o]=t,a=e?r:this.height-r,{pixelUnprojectionMatrix:c}=this;let h;if(Number.isFinite(o))h=rt(c,[i,a,o,1]);else{const f=rt(c,[i,a,-1,1]),g=rt(c,[i,a,1,1]),y=((s||0)/K+1)*N,_=nt(Ce([],f,g)),v=nt(f),M=nt(g),C=4*((4*v*M-(_-v-M)**2)/16)/_,I=Math.sqrt(v-C),P=Math.sqrt(Math.max(0,y*y-C)),U=(I-P)/Math.sqrt(_);h=Ee([],f,g,U)}const[l,u,d]=this.unprojectPosition(h);return Number.isFinite(o)?[l,u,d]:Number.isFinite(s)?[l,u,s]:[l,u]}projectPosition(t){const[e,s,i=0]=t,r=e*G,o=s*G,a=Math.cos(o),c=(i/K+1)*N;return[Math.sin(r)*a*c,-Math.cos(r)*a*c,Math.sin(o)*c]}unprojectPosition(t){const[e,s,i]=t,r=Gt(t),o=Math.asin(i/r),c=Math.atan2(e,-s)*Lt,h=o*Lt,l=(r/N-1)*K;return[c,h,l]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,e){const s=this.unproject(e);return{longitude:t[0]-s[0]+this.longitude,latitude:t[1]-s[1]+this.latitude}}}function rt(n,t){const e=Ae([],t,n);return Wt(e,e,1/e[3]),e}const _s=new Uint16Array([0,2,1,0,3,2]),vs=new Float32Array([0,1,0,0,1,0,1,1]);function xs(n,t){if(!t)return Ts(n);const e=Math.max(Math.abs(n[0][0]-n[3][0]),Math.abs(n[1][0]-n[2][0])),s=Math.max(Math.abs(n[1][1]-n[0][1]),Math.abs(n[2][1]-n[3][1])),i=Math.ceil(e/t)+1,r=Math.ceil(s/t)+1,o=(i-1)*(r-1)*6,a=new Uint32Array(o),c=new Float32Array(i*r*2),h=new Float64Array(i*r*3);let l=0,u=0;for(let d=0;d<i;d++){const f=d/(i-1);for(let g=0;g<r;g++){const y=g/(r-1),_=Ms(n,f,y);h[l*3+0]=_[0],h[l*3+1]=_[1],h[l*3+2]=_[2]||0,c[l*2+0]=f,c[l*2+1]=1-y,d>0&&g>0&&(a[u++]=l-r,a[u++]=l-r-1,a[u++]=l-1,a[u++]=l-r,a[u++]=l-1,a[u++]=l),l++}}return{vertexCount:o,positions:h,indices:a,texCoords:c}}function Ts(n){const t=new Float64Array(12);for(let e=0;e<n.length;e++)t[e*3+0]=n[e][0],t[e*3+1]=n[e][1],t[e*3+2]=n[e][2]||0;return{vertexCount:6,positions:t,indices:_s,texCoords:vs}}function Ms(n,t,e){return it(it(n[0],n[1],e),it(n[3],n[2],e),t)}const bs=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,Ss=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,Cs=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(Ss,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive && !picking_uAttribute) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`),Es={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Zt.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}};class Yt extends we{constructor(...t){super(...t),m(this,"state",void 0)}getShaders(){return super.getShaders({vs:bs,fs:Cs,modules:[Le,Oe]})}initializeState(){const t=this.getAttributeManager();t.remove(["instancePickingColors"]);const e=!0;t.add({indices:{size:1,isIndexed:!0,update:s=>s.value=this.state.mesh.indices,noAlloc:e},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:s=>s.value=this.state.mesh.positions,noAlloc:e},texCoords:{size:2,update:s=>s.value=this.state.mesh.texCoords,noAlloc:e}})}updateState({props:t,oldProps:e,changeFlags:s}){const i=this.getAttributeManager();if(s.extensionsChanged){var r;const{gl:o}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(o),i.invalidateAll()}if(t.bounds!==e.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const c in a)o&&o[c]!==a[c]&&i.invalidate(c);this.setState({mesh:a,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==e._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){const{image:e}=this.props,s=t.info;if(!s.color||!e)return s.bitmap=null,s;const{width:i,height:r}=e;s.index=0;const o=As(s.color),a=[Math.floor(o[0]*i),Math.floor(o[1]*r)];return s.bitmap={size:{width:i,height:r},uv:o,pixel:a},s}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:t}=this.props;let e=t;return Ot(t)&&(e=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),xs(e,this.context.viewport.resolution)}_getModel(t){return t?new Re(t,{...this.getShaders(),id:this.props.id,geometry:new Ie({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(t){const{uniforms:e,moduleParameters:s}=t,{model:i,coordinateConversion:r,bounds:o,disablePicking:a}=this.state,{image:c,desaturate:h,transparentColor:l,tintColor:u}=this.props;s.pickingActive&&a||c&&i&&i.setUniforms(e).setUniforms({bitmapTexture:c,desaturate:h,transparentColor:l.map(d=>d/255),tintColor:u.slice(0,3).map(d=>d/255),coordinateConversion:r,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:t,CARTESIAN:e,DEFAULT:s}=Zt;let{_imageCoordinateSystem:i}=this.props;if(i!==s){const{bounds:r}=this.props;if(!Ot(r))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?t:e;if(i=i===t?t:e,i===t&&o===e)return{coordinateConversion:-1,bounds:r};if(i===e&&o===t){const a=tt([r[0],r[1]]),c=tt([r[2],r[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}m(Yt,"layerName","BitmapLayer");m(Yt,"defaultProps",Es);function As(n){const[t,e,s]=n,i=(s&240)/256,r=(s&15)/16;return[(t+r)/256,(e+i)/256]}function Ot(n){return Number.isFinite(n[0])}class ws{constructor(t){m(this,"index",void 0),m(this,"isVisible",void 0),m(this,"isSelected",void 0),m(this,"parent",void 0),m(this,"children",void 0),m(this,"content",void 0),m(this,"state",void 0),m(this,"layers",void 0),m(this,"id",void 0),m(this,"zoom",void 0),m(this,"userData",void 0),m(this,"boundingBox",void 0),m(this,"_abortController",void 0),m(this,"_loader",void 0),m(this,"_loaderId",void 0),m(this,"_isLoaded",void 0),m(this,"_isCancelled",void 0),m(this,"_needsReload",void 0),m(this,"_bbox",void 0),this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:e,onLoad:s,onError:i}){const{index:r,id:o,bbox:a,userData:c,zoom:h}=this,l=this._loaderId;this._abortController=new AbortController;const{signal:u}=this._abortController,d=await e.scheduleRequest(this,y=>y.isSelected?1:-1);if(!d){this._isCancelled=!0;return}if(this._isCancelled){d.done();return}let f=null,g;try{f=await t({index:r,id:o,bbox:a,userData:c,zoom:h,signal:u})}catch(y){g=y||!0}finally{d.done()}if(l===this._loaderId){if(this._loader=void 0,this.content=f,this._isCancelled&&!f){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,g?i(g,this):s(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var t;this.isLoaded||(this._isCancelled=!0,(t=this._abortController)===null||t===void 0||t.abort())}}const T={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},Rt=new p,Ls=new p;class ft{constructor(t=[0,0,0],e=[0,0,0],s){m(this,"center",void 0),m(this,"halfDiagonal",void 0),m(this,"minimum",void 0),m(this,"maximum",void 0),s=s||Rt.copy(t).add(e).scale(.5),this.center=new p(s),this.halfDiagonal=new p(e).subtract(this.center),this.minimum=new p(t),this.maximum=new p(e)}clone(){return new ft(this.minimum,this.maximum,this.center)}equals(t){return this===t||!!t&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:e}=this,s=Ls.from(t.normal),i=e.x*Math.abs(s.x)+e.y*Math.abs(s.y)+e.z*Math.abs(s.z),r=this.center.dot(s)+t.distance;return r-i>0?T.INSIDE:r+i<0?T.OUTSIDE:T.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=Rt.from(t).subtract(this.center),{halfDiagonal:s}=this;let i=0,r;return r=Math.abs(e.x)-s.x,r>0&&(i+=r*r),r=Math.abs(e.y)-s.y,r>0&&(i+=r*r),r=Math.abs(e.z)-s.z,r>0&&(i+=r*r),i}}const k=new p,It=new p;class mt{constructor(t=[0,0,0],e=0){m(this,"center",void 0),m(this,"radius",void 0),this.radius=-0,this.center=new p,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=k.from(e),this.center=new p().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new mt(this.center,this.radius)}union(t){const e=this.center,s=this.radius,i=t.center,r=t.radius,o=k.copy(i).subtract(e),a=o.magnitude();if(s>=a+r)return this.clone();if(r>=a+s)return t.clone();const c=(s+a+r)*.5;return It.copy(o).scale((-s+c)/a).add(e),this.center.copy(It),this.radius=c,this}expand(t){const s=k.from(t).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(t){this.center.transform(t);const e=Pe(k,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const s=k.from(t).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(t){const e=this.center,s=this.radius,r=t.normal.dot(e)+t.distance;return r<-s?T.OUTSIDE:r<s?T.INTERSECTING:T.INSIDE}}const Os=new p,Rs=new p,Z=new p,j=new p,$=new p,Is=new p,Ps=new p,w={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class pt{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){m(this,"center",void 0),m(this,"halfAxes",void 0),this.center=new p().from(t),this.halfAxes=new x(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new p(t).len(),new p(e).len(),new p(s).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),i=new p(t).normalize(),r=new p(e).normalize(),o=new p(s).normalize();return new wt().fromMatrix3(new x([...i,...r,...o]))}fromCenterHalfSizeQuaternion(t,e,s){const i=new wt(s),r=new x().fromQuaternion(i);return r[0]=r[0]*e[0],r[1]=r[1]*e[0],r[2]=r[2]*e[0],r[3]=r[3]*e[1],r[4]=r[4]*e[1],r[5]=r[5]*e[1],r[6]=r[6]*e[2],r[7]=r[7]*e[2],r[8]=r[8]*e[2],this.center=new p().from(t),this.halfAxes=r,this}clone(){return new pt(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new mt){const e=this.halfAxes,s=e.getColumn(0,Z),i=e.getColumn(1,j),r=e.getColumn(2,$),o=Os.copy(s).add(i).add(r);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const e=this.center,s=t.normal,i=this.halfAxes,r=s.x,o=s.y,a=s.z,c=Math.abs(r*i[w.COLUMN0ROW0]+o*i[w.COLUMN0ROW1]+a*i[w.COLUMN0ROW2])+Math.abs(r*i[w.COLUMN1ROW0]+o*i[w.COLUMN1ROW1]+a*i[w.COLUMN1ROW2])+Math.abs(r*i[w.COLUMN2ROW0]+o*i[w.COLUMN2ROW1]+a*i[w.COLUMN2ROW2]),h=s.dot(e)+t.distance;return h<=-c?T.OUTSIDE:h>=c?T.INSIDE:T.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=Rs.from(t).subtract(this.center),s=this.halfAxes,i=s.getColumn(0,Z),r=s.getColumn(1,j),o=s.getColumn(2,$),a=i.magnitude(),c=r.magnitude(),h=o.magnitude();i.normalize(),r.normalize(),o.normalize();let l=0,u;return u=Math.abs(e.dot(i))-a,u>0&&(l+=u*u),u=Math.abs(e.dot(r))-c,u>0&&(l+=u*u),u=Math.abs(e.dot(o))-h,u>0&&(l+=u*u),l}computePlaneDistances(t,e,s=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,Z),h=a.getColumn(1,j),l=a.getColumn(2,$),u=Is.copy(c).add(h).add(l).add(o),d=Ps.copy(u).subtract(t);let f=e.dot(d);return i=Math.min(f,i),r=Math.max(f,r),u.copy(o).add(c).add(h).subtract(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),u.copy(o).add(c).subtract(h).add(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),u.copy(o).add(c).subtract(h).subtract(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),o.copy(u).subtract(c).add(h).add(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),o.copy(u).subtract(c).add(h).subtract(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),o.copy(u).subtract(c).subtract(h).add(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),o.copy(u).subtract(c).subtract(h).subtract(l),d.copy(u).subtract(t),f=e.dot(d),i=Math.min(f,i),r=Math.max(f,r),s[0]=i,s[1]=r,s}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Z);e.transformAsPoint(t);const s=this.halfAxes.getColumn(1,j);s.transformAsPoint(t);const i=this.halfAxes.getColumn(2,$);return i.transformAsPoint(t),this.halfAxes=new x([...e,...s,...i]),this}getTransform(){throw new Error("not implemented")}}const Pt=new p,Nt=new p;class D{constructor(t=[0,0,1],e=0){m(this,"normal",void 0),m(this,"distance",void 0),this.normal=new p,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return ot(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=Pt.from(t),this.normal.from(e).normalize();const s=-this.normal.dot(t);return this.distance=s,this}fromCoefficients(t,e,s,i){return this.normal.set(t,e,s),ot(Y(this.normal.len(),1)),this.distance=i,this}clone(){return new D(this.normal,this.distance)}equals(t){return Y(this.distance,t.distance)&&Y(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=Nt.copy(this.normal).transformAsVector(t).normalize(),s=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(s,e)}projectPointOntoPlane(t,e=[0,0,0]){t=Pt.from(t);const s=this.getPointDistance(t),i=Nt.copy(this.normal).scale(s);return t.subtract(i).to(e)}}const zt=[new p([1,0,0]),new p([0,1,0]),new p([0,0,1])],qt=new p,Ns=new p;new D(new p(1,0,0),0);class L{constructor(t=[]){m(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*zt.length;const e=t.center,s=t.radius;let i=0;for(const r of zt){let o=this.planes[i],a=this.planes[i+1];o||(o=this.planes[i]=new D),a||(a=this.planes[i+1]=new D);const c=qt.copy(r).scale(-s).add(e);-r.dot(c),o.fromPointNormal(c,r);const h=qt.copy(r).scale(s).add(e),l=Ns.copy(r).negate();-l.dot(h),a.fromPointNormal(h,l),i+=2}return this}computeVisibility(t){let e=T.INSIDE;for(const s of this.planes)switch(t.intersectPlane(s)){case T.OUTSIDE:return T.OUTSIDE;case T.INTERSECTING:e=T.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(ot(Number.isFinite(e),"parentPlaneMask is required."),e===L.MASK_OUTSIDE||e===L.MASK_INSIDE)return e;let s=L.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&!(e&o))continue;const a=i[r],c=t.intersectPlane(a);if(c===T.OUTSIDE)return L.MASK_OUTSIDE;c===T.INTERSECTING&&(s|=o)}return s}}m(L,"MASK_OUTSIDE",4294967295);m(L,"MASK_INSIDE",0);m(L,"MASK_INDETERMINATE",2147483647);new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;new p;const E=new x,zs=new x,qs=new x,X=new x,Dt=new x;function Ds(n,t={}){const e=Qt.EPSILON20,s=10;let i=0,r=0;const o=zs,a=qs;o.identity(),a.copy(n);const c=e*Us(a);for(;r<s&&Vs(a)>c;)ks(a,X),Dt.copy(X).transpose(),a.multiplyRight(X),a.multiplyLeft(Dt),o.multiplyRight(X),++i>2&&(++r,i=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function Us(n){let t=0;for(let e=0;e<9;++e){const s=n[e];t+=s*s}return Math.sqrt(t)}const ct=[1,0,0],ht=[2,2,1];function Vs(n){let t=0;for(let e=0;e<3;++e){const s=n[E.getElementIndex(ht[e],ct[e])];t+=2*s*s}return Math.sqrt(t)}function ks(n,t){const e=Qt.EPSILON15;let s=0,i=1;for(let h=0;h<3;++h){const l=Math.abs(n[E.getElementIndex(ht[h],ct[h])]);l>s&&(i=h,s=l)}const r=ct[i],o=ht[i];let a=1,c=0;if(Math.abs(n[E.getElementIndex(o,r)])>e){const h=n[E.getElementIndex(o,o)],l=n[E.getElementIndex(r,r)],u=n[E.getElementIndex(o,r)],d=(h-l)/2/u;let f;d<0?f=-1/(-d+Math.sqrt(1+d*d)):f=1/(d+Math.sqrt(1+d*d)),a=1/Math.sqrt(1+f*f),c=f*a}return x.IDENTITY.to(t),t[E.getElementIndex(r,r)]=t[E.getElementIndex(o,o)]=a,t[E.getElementIndex(o,r)]=c,t[E.getElementIndex(r,o)]=-c,t}const R=new p,Bs=new p,Fs=new p,Ws=new p,Gs=new p,Zs=new x,js={diagonal:new x,unitary:new x};function $s(n,t=new pt){if(!n||n.length===0)return t.halfAxes=new x([0,0,0,0,0,0,0,0,0]),t.center=new p,t;const e=n.length,s=new p(0,0,0);for(const V of n)s.add(V);const i=1/e;s.multiplyByScalar(i);let r=0,o=0,a=0,c=0,h=0,l=0;for(const V of n){const S=R.copy(V).subtract(s);r+=S.x*S.x,o+=S.x*S.y,a+=S.x*S.z,c+=S.y*S.y,h+=S.y*S.z,l+=S.z*S.z}r*=i,o*=i,a*=i,c*=i,h*=i,l*=i;const u=Zs;u[0]=r,u[1]=o,u[2]=a,u[3]=o,u[4]=c,u[5]=h,u[6]=a,u[7]=h,u[8]=l;const{unitary:d}=Ds(u,js),f=t.halfAxes.copy(d);let g=f.getColumn(0,Fs),y=f.getColumn(1,Ws),_=f.getColumn(2,Gs),v=-Number.MAX_VALUE,M=-Number.MAX_VALUE,A=-Number.MAX_VALUE,C=Number.MAX_VALUE,I=Number.MAX_VALUE,P=Number.MAX_VALUE;for(const V of n)R.copy(V),v=Math.max(R.dot(g),v),M=Math.max(R.dot(y),M),A=Math.max(R.dot(_),A),C=Math.min(R.dot(g),C),I=Math.min(R.dot(y),I),P=Math.min(R.dot(_),P);g=g.multiplyByScalar(.5*(C+v)),y=y.multiplyByScalar(.5*(I+M)),_=_.multiplyByScalar(.5*(P+A)),t.center.copy(g).add(y).add(_);const U=Bs.set(v-C,M-I,A-P).multiplyByScalar(.5),se=new x([U[0],0,0,0,U[1],0,0,0,U[2]]);return t.halfAxes.multiplyRight(se),t}const z=512,Ut=3,Ht=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Kt=Ht.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Xs=Kt.concat([[.25,.5],[.75,.5]]);class q{constructor(t,e,s){m(this,"x",void 0),m(this,"y",void 0),m(this,"z",void 0),m(this,"childVisible",void 0),m(this,"selected",void 0),m(this,"_children",void 0),this.x=t,this.y=e,this.z=s}get children(){if(!this._children){const t=this.x*2,e=this.y*2,s=this.z+1;this._children=[new q(t,e,s),new q(t,e+1,s),new q(t+1,e,s),new q(t+1,e+1,s)]}return this._children}update(t){const{viewport:e,cullingVolume:s,elevationBounds:i,minZ:r,maxZ:o,bounds:a,offset:c,project:h}=t,l=this.getBoundingVolume(i,c,h);if(a&&!this.insideBounds(a)||s.computeVisibility(l)<0)return!1;if(!this.childVisible){let{z:d}=this;if(d<o&&d>=r){const f=l.distanceTo(e.cameraPosition)*e.scale/e.height;d+=Math.floor(Math.log2(f))}if(d>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const d of this.children)d.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const e of this._children)e.getSelected(t);return t}insideBounds([t,e,s,i]){const r=Math.pow(2,this.z),o=z/r;return this.x*o<s&&this.y*o<i&&(this.x+1)*o>t&&(this.y+1)*o>e}getBoundingVolume(t,e,s){if(s){const c=this.z<1?Xs:this.z<2?Kt:Ht,h=[];for(const l of c){const u=ut(this.x+l[0],this.y+l[1],this.z);u[2]=t[0],h.push(s(u)),t[0]!==t[1]&&(u[2]=t[1],h.push(s(u)))}return $s(h)}const i=Math.pow(2,this.z),r=z/i,o=this.x*r+e*z,a=z-(this.y+1)*r;return new ft([o,a,t[0]],[o+r,a+r,t[1]])}}function Qs(n,t,e,s){const i=n instanceof ys&&n.resolution?n.projectPosition:null,r=Object.values(n.getFrustumPlanes()).map(({normal:f,distance:g})=>new D(f.clone().negate(),g)),o=new L(r),a=n.distanceScales.unitsPerMeter[2],c=e&&e[0]*a||0,h=e&&e[1]*a||0,l=n instanceof Tt&&n.pitch<=60?t:0;if(s){const[f,g,y,_]=s,v=tt([f,_]),M=tt([y,g]);s=[v[0],z-v[1],M[0],z-M[1]]}const u=new q(0,0,0),d={viewport:n,project:i,cullingVolume:o,elevationBounds:[c,h],minZ:l,maxZ:t,bounds:s,offset:0};if(u.update(d),n instanceof Tt&&n.subViewports&&n.subViewports.length>1){for(d.offset=-1;u.update(d)&&!(--d.offset<-Ut););for(d.offset=1;u.update(d)&&!(++d.offset>Ut););}return u.getSelected()}const O=512,Ys=[-1/0,-1/0,1/0,1/0],Hs={type:"object",value:null,validate:(n,t)=>t.optional&&n===null||typeof n=="string"||Array.isArray(n)&&n.every(e=>typeof e=="string"),equal:(n,t)=>{if(n===t)return!0;if(!Array.isArray(n)||!Array.isArray(t))return!1;const e=n.length;if(e!==t.length)return!1;for(let s=0;s<e;s++)if(n[s]!==t[s])return!1;return!0}};function Jt(n,t){const e=[t.transformAsPoint([n[0],n[1]]),t.transformAsPoint([n[2],n[1]]),t.transformAsPoint([n[0],n[3]]),t.transformAsPoint([n[2],n[3]])];return[Math.min(...e.map(i=>i[0])),Math.min(...e.map(i=>i[1])),Math.max(...e.map(i=>i[0])),Math.max(...e.map(i=>i[1]))]}function Ks(n){return Math.abs(n.split("").reduce((t,e)=>(t<<5)-t+e.charCodeAt(0)|0,0))}function Js(n,t){if(!n||!n.length)return null;const{index:e,id:s}=t;if(Array.isArray(n)){const r=Ks(s)%n.length;n=n[r]}let i=n;for(const r of Object.keys(e)){const o=new RegExp("{".concat(r,"}"),"g");i=i.replace(o,String(e[r]))}return Number.isInteger(e.y)&&Number.isInteger(e.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,e.z)-e.y-1))),i}function tn(n,t,e){let s;if(t&&t.length===2){const[i,r]=t,o=n.getBounds({z:i}),a=n.getBounds({z:r});s=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else s=n.getBounds();return n.isGeospatial?[Math.max(s[0],e[0]),Math.max(s[1],e[1]),Math.min(s[2],e[2]),Math.min(s[3],e[3])]:[Math.max(Math.min(s[0],e[2]),e[0]),Math.max(Math.min(s[1],e[3]),e[1]),Math.min(Math.max(s[2],e[0]),e[2]),Math.min(Math.max(s[3],e[1]),e[3])]}function en({viewport:n,z:t=0,cullRect:e}){return(n.subViewports||[n]).map(i=>lt(i,t,e))}function lt(n,t,e){if(!Array.isArray(t)){const r=e.x-n.x,o=e.y-n.y,{width:a,height:c}=e,h={targetZ:t},l=n.unproject([r,o],h),u=n.unproject([r+a,o],h),d=n.unproject([r,o+c],h),f=n.unproject([r+a,o+c],h);return[Math.min(l[0],u[0],d[0],f[0]),Math.min(l[1],u[1],d[1],f[1]),Math.max(l[0],u[0],d[0],f[0]),Math.max(l[1],u[1],d[1],f[1])]}const s=lt(n,t[0],e),i=lt(n,t[1],e);return[Math.min(s[0],i[0]),Math.min(s[1],i[1]),Math.max(s[2],i[2]),Math.max(s[3],i[3])]}function sn(n,t,e){return e?Jt(n,e).map(i=>i*t/O):n.map(s=>s*t/O)}function gt(n,t){return Math.pow(2,n)*O/t}function ut(n,t,e){const s=gt(e,O),i=n/s*360-180,r=Math.PI-2*Math.PI*t/s,o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,o]}function Vt(n,t,e,s){const i=gt(e,s);return[n/i*O,t/i*O]}function nn(n,t,e,s,i=O){if(n.isGeospatial){const[h,l]=ut(t,e,s),[u,d]=ut(t+1,e+1,s);return{west:h,north:l,east:u,south:d}}const[r,o]=Vt(t,e,s,i),[a,c]=Vt(t+1,e+1,s,i);return{left:r,top:o,right:a,bottom:c}}function rn(n,t,e,s,i){const r=tn(n,null,s),o=gt(t,e),[a,c,h,l]=sn(r,o,i),u=[];for(let d=Math.floor(a);d<h;d++)for(let f=Math.floor(c);f<l;f++)u.push({x:d,y:f,z:t});return u}function on({viewport:n,maxZoom:t,minZoom:e,zRange:s,extent:i,tileSize:r=O,modelMatrix:o,modelMatrixInverse:a,zoomOffset:c=0}){let h=n.isGeospatial?Math.round(n.zoom+Math.log2(O/r))+c:Math.ceil(n.zoom)+c;if(typeof e=="number"&&Number.isFinite(e)&&h<e){if(!i)return[];h=e}typeof t=="number"&&Number.isFinite(t)&&h>t&&(h=t);let l=i;return o&&a&&i&&!n.isGeospatial&&(l=Jt(i,o)),n.isGeospatial?Qs(n,h,s,i):rn(n,h,r,l||Ys,a)}function an(n){let t={},e;return s=>{for(const i in s)if(!cn(s[i],t[i])){e=n(s),t=s;break}return e}}function cn(n,t){if(n===t)return!0;if(Array.isArray(n)){const e=n.length;if(!t||t.length!==e)return!1;for(let s=0;s<e;s++)if(n[s]!==t[s])return!1;return!0}return!1}const kt=1,et=2,hn="never",ln="no-overlap",yt="best-available",un=5,dn={[yt]:pn,[ln]:gn,[hn]:()=>{}},fn={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class mn{constructor(t){m(this,"opts",void 0),m(this,"_requestScheduler",void 0),m(this,"_cache",void 0),m(this,"_dirty",void 0),m(this,"_tiles",void 0),m(this,"_cacheByteSize",void 0),m(this,"_viewport",void 0),m(this,"_zRange",void 0),m(this,"_selectedTiles",void 0),m(this,"_frameNumber",void 0),m(this,"_modelMatrix",void 0),m(this,"_modelMatrixInverse",void 0),m(this,"_maxZoom",void 0),m(this,"_minZoom",void 0),m(this,"onTileLoad",void 0),m(this,"_getCullBounds",an(en)),this.opts={...fn,...t},this.onTileLoad=e=>{var s,i;(s=(i=this.opts).onTileLoad)===null||s===void 0||s.call(i,e),this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new Ge({maxRequests:t.maxRequests,throttleRequests:!!(t.maxRequests&&t.maxRequests>0)}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Q,this._modelMatrixInverse=new Q,this.setOptions(t)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const e=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(e)?this._cache.delete(t):e.setNeedsReload()}}update(t,{zRange:e,modelMatrix:s}={}){const i=new Q(s),r=!i.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!Y(this._zRange,e)||r){r&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=t,this._zRange=e;const a=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:e,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(c=>this._getTile(c,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(t,e){if(!t.isVisible)return!1;if(e&&this._viewport){const s=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:e}),{bbox:i}=t;for(const[r,o,a,c]of s){let h;if("west"in i)h=i.west<a&&i.east>r&&i.south<c&&i.north>o;else{const l=Math.min(i.top,i.bottom),u=Math.max(i.top,i.bottom);h=i.left<a&&i.right>r&&l<c&&u>o}if(h)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:e,minZoom:s,zRange:i,modelMatrix:r,modelMatrixInverse:o}){const{tileSize:a,extent:c,zoomOffset:h}=this.opts;return on({viewport:t,maxZoom:e,minZoom:s,zRange:i,tileSize:a,extent:c,modelMatrix:r,modelMatrixInverse:o,zoomOffset:h})}getTileId(t){return"".concat(t.x,"-").concat(t.y,"-").concat(t.z)}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:e}=this.opts;return{bbox:nn(this._viewport,t.x,t.y,t.z,e)}}getParentIndex(t){const e=Math.floor(t.x/2),s=Math.floor(t.y/2),i=t.z-1;return{x:e,y:s,z:i}}updateTileStates(){const t=this.opts.refinementStrategy||yt,e=new Array(this._cache.size);let s=0;for(const i of this._cache.values())e[s++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof t=="function"?t:dn[t])(Array.from(this._cache.values())),s=0;for(const i of this._cache.values())if(e[s++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t=0}=this.opts,e=[];let s=0;for(const i of this._cache.values())i.isLoading&&(s++,!i.isSelected&&!i.isVisible&&e.push(i));for(;t>0&&s>t&&e.length>0;)e.shift().abort(),s--}_rebuildTree(){const{_cache:t}=this;for(const e of t.values())e.parent=null,e.children&&(e.children.length=0);for(const e of t.values()){const s=this._getNearestAncestor(e);e.parent=s,s!=null&&s.children&&s.children.push(e)}}_resizeCache(){const{_cache:t,opts:e}=this,s=e.maxCacheSize||(e.maxCacheByteSize?1/0:un*this.selectedTiles.length),i=e.maxCacheByteSize||1/0;if(t.size>s||this._cacheByteSize>i){for(const[c,h]of t){if(!h.isVisible&&!h.isSelected){var o,a;this._cacheByteSize-=e.maxCacheByteSize?h.byteLength:0,t.delete(c),(o=(a=this.opts).onTileUnload)===null||o===void 0||o.call(a,h)}if(t.size<=s&&this._cacheByteSize<=i)break}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((c,h)=>c.zoom-h.zoom),this._dirty=!1)}_getTile(t,e){const s=this.getTileId(t);let i=this._cache.get(s),r=!1;return!i&&e?(i=new ws(t),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:s,zoom:this.getTileZoom(i.index)}),r=!0,this._cache.set(s,i),this._dirty=!0):i&&i.needsReload&&(r=!0),i&&r&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(t){const{_minZoom:e=0}=this;let s=t.index;for(;this.getTileZoom(s)>e;){s=this.getParentIndex(s);const i=this._getTile(s);if(i)return i}return null}}function pn(n){for(const t of n)t.state=0;for(const t of n)t.isSelected&&!te(t)&&_t(t);for(const t of n)t.isVisible=!!(t.state&et)}function gn(n){for(const e of n)e.state=0;for(const e of n)e.isSelected&&te(e);const t=Array.from(n).sort((e,s)=>e.zoom-s.zoom);for(const e of t)if(e.isVisible=!!(e.state&et),e.children&&(e.isVisible||e.state&kt))for(const s of e.children)s.state=kt;else e.isSelected&&_t(e)}function te(n){let t=n;for(;t;){if(t.isLoaded||t.content)return t.state|=et,!0;t=t.parent}return!1}function _t(n){for(const t of n.children)t.isLoaded||t.content?t.state|=et:_t(t)}const yn={TilesetClass:mn,data:{type:"data",value:[]},dataComparator:Hs.equal,renderSubLayers:{type:"function",value:n=>new qe(n)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:n=>{}},onTileUnload:{type:"function",value:n=>{}},onTileError:{type:"function",value:n=>console.error(n)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:yt,zRange:null,maxRequests:6,zoomOffset:0};class ee extends Ne{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var t,e;(t=this.state)===null||t===void 0||(e=t.tileset)===null||e===void 0||e.finalize()}get isLoaded(){var t,e,s;return(t=this.state)===null||t===void 0||(e=t.tileset)===null||e===void 0||(s=e.selectedTiles)===null||s===void 0?void 0:s.every(i=>i.isLoaded&&i.layers&&i.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:e}=this.state;const s=t.propsOrDataChanged||t.updateTriggersChanged,i=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);e?s&&(e.setOptions(this._getTilesetOptions()),i?e.reloadAll():this.state.tileset.tiles.forEach(r=>{r.layers=null})):(e=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:e})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:e,maxCacheByteSize:s,refinementStrategy:i,extent:r,maxZoom:o,minZoom:a,maxRequests:c,zoomOffset:h}=this.props;return{maxCacheSize:e,maxCacheByteSize:s,maxZoom:o,minZoom:a,tileSize:t,refinementStrategy:i,extent:r,maxRequests:c,zoomOffset:h,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:t}=this.state,{zRange:e,modelMatrix:s}=this.props,i=t.update(this.context.viewport,{zRange:e,modelMatrix:s}),{isLoaded:r}=t,o=this.state.isLoaded!==r,a=this.state.frameNumber!==i;r&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:i}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:e}=this.props;e&&e(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,e){this.props.onTileError(t),e.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:e,getTileData:s,fetch:i}=this.props,{signal:r}=t;return t.url=typeof e=="string"||Array.isArray(e)?Js(e,t):null,s?s(t):i&&t.url?i(t.url,{propName:"data",layer:this,signal:r}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo({info:t,sourceLayer:e}){const s=e.props.tile;return t.picked&&(t.tile=s),t.sourceTile=s,t}_updateAutoHighlight(t){const e=t.sourceTile;if(e&&e.layers)for(const s of e.layers)s.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{const e=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)e&&t.layers[0]&&Object.keys(e).some(s=>t.layers[0].props[s]!==e[s])&&(t.layers=t.layers.map(s=>s.clone(e)));else{const s=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=ze(s,Boolean).map(i=>i.clone({tile:t,...e}))}return t.layers})}filterSubLayer({layer:t,cullRect:e}){const{tile:s}=t.props;return this.state.tileset.isTileVisible(s,e)}}m(ee,"defaultProps",yn);m(ee,"layerName","TileLayer");export{Yt as B,ee as T};
