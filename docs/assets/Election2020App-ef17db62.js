import{r as o,R as n}from"./index-47bc6533.js";import{C as S,M as P,m as I,l as H,L as D,q as R,n as z,s as E,h as b,e as V,f as F,g as O,k as U,o as A,p as x}from"./settings-3f87ae0a.js";import{D as G,g as $,U as y,a as C}from"./overlay-27be0fdc.js";import{E as s,e as T,a as w,u as N,T as _}from"./electionInterps-d58b56f5.js";import{u as M}from"./useHexTooltip-de310431.js";import{u as W}from"./useHexMouseEvts-e2c6d0a8.js";import{O as q}from"./index-bac40e01.js";import{S as k,P as K,I as j}from"./SolidHexTileLayer-72de8124.js";import{D as B}from"./DeagHexTileLayer-0ebf5e53.js";import{G as J,l as X}from"./index-230f96f1.js";import{s as h}from"./selectAll-b7696bd5.js";import"./scales-0efcb647.js";class L extends S{renderLayers(){const{data:a,curOption:g,speedyCounter:l=1026,clickedHexes:m,selectionFinalized:c,visible:d,zoomRange:r,useVsup:t,showAllRings:u}=this.props;return[new k({id:"Party",data:a,thicknessRange:[0,1],getFillColor:e=>t?s.party.interpVsup(e.properties.DemLead||0,e.properties.DemLeadVar||0):s.party.interpColor(e.properties.DemLead||0),opacity:1,visible:d,updateTriggers:{getFillColor:[l,t]},zoomRange:r,pickable:!1}),new k({id:"PoC",data:a,thicknessRange:[.4,.65],getFillColor:e=>s.poc.interpColor(e.properties.PoC,!u),getValue:e=>t?s.poc.scaleLinearVar(e.properties.PoCVar)*.7+.3:1,raised:!0,visible:d,getElevation:e=>e.hexId in m?5e3:0,getLineWidth:e=>e.hexId in m?100:0,stroked:!0,extruded:!1,lineJointRounded:!0,getLineColor:[255,255,255,200],getOffset:-.5,extensions:[new K({offset:!0})],opacity:1,updateTriggers:{getFillColor:[g,l,u],getValue:[g,l,t],getElevation:[c],getLineWidth:[c]},zoomRange:r,pickable:!1}),new j({id:"Population",data:a,loaders:[q],mesh:"assets/human.obj",raised:!0,getColor:e=>[255,255,7,(t?s.population.scaleLinearVar(e.properties.PopSqKmVar):1)*200+55],getValue:e=>s.population.scaleLinear(e.properties.PopSqKm),visible:d,sizeScale:400,opacity:1,updateTriggers:{getTranslation:[l],getColor:[t]},zoomRange:r,pickable:!1}),new B({...this.props,id:"DeagLayer",data:a,deagData:T,getFillColor:e=>s.party.interpColor(e.properties.pct_dem_lead,!1,!1)})]}}L.layerName="MultivariableHextileLayer";L.defaultProps={...S.defaultProps,autoHighlight:!0};function ce(){const{current:p}=o.useRef(Object.keys(w).map(i=>parseInt(i))),[a,g]=o.useState(5),[l,m]=o.useState(!1),[c,d]=o.useState(!1),r=N(),t=W({disabled:r.curOption>1,dataDeag:T,deagKey:"PrecinctRgs"}),u=M(r),e={data:w,...r,...t};return n.createElement(n.Fragment,null,n.createElement(P,{reuseMaps:!0,preventStyleDiffing:!0,mapLib:I,mapStyle:"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",antialias:!0,initialViewState:H},n.createElement(G,{getTooltip:u,interleaved:!0,effects:[D],onViewStateChange:({viewState:i})=>{g(i.zoom)},antialias:!0},n.createElement(J,{id:"ground",data:_,stroked:!1,getFillColor:[0,0,0,0],beforeId:"landcover"}),n.createElement(L,{id:"slide-election",...e,zoomRange:[5,7],visible:!0,useVsup:l,showAllRings:c,beforeId:"place_hamlet"}))),n.createElement(Z,{res:R().domain([0,1]).range(p)(z().domain([5,7]).range([0,1]).clamp(!0)(a)),useVsup:l,setUseVsup:m,showAllRings:c,setShowAllRings:d}))}function Z({res:p,useVsup:a,setUseVsup:g,showAllRings:l,setShowAllRings:m}){const c=o.useRef(),d=o.useRef();return o.useEffect(()=>{h(".lin-legend").style("visibility",a?"hidden":"visible"),h(".vsup-legend-v").style("visibility",a?"visible":"hidden"),h(".vsup-legend-u").attr("transform",`translate(0,${a?0:50})`),h(".box1").attr("transform",`translate(0,${a?0:150})`).attr("height",a?250:100).attr("width",a?250:300),h(".box2").attr("transform",`translate(0,${a?0:60})`).attr("height",a?170:110)},[a]),o.useEffect(()=>{E("#diff-u").html("").call(b(s.poc,"% PoC",l))},[l]),o.useLayoutEffect(()=>{const r=E(c.current).attr("width",window.innerWidth).attr("height",window.innerHeight),t=200,u=window.innerWidth,e=r.append("g").attr("transform",`translate(0,${window.innerHeight-t})`);e.append("g").attr("transform",`translate(0,${t-250})`).append("rect").attr("class","box1").attr("height",250).attr("width",250).attr("fill","white"),e.append("g").attr("transform",`translate(0,${t-170})`).append("rect").attr("class","box2").attr("height",170).attr("width",920).attr("x",350).attr("fill","white"),e.append("g").attr("class","vsup-legend-v").append("g").call(V().vtitle("% Dem. Lead").utitle("Variance").scale(s.party.vsup).size(150).x(40).y(t-150-40)),e.append("g").attr("class","lin-legend").append("g").call(X.simpleLegend(null,250,20,".2s").title("% Dem. Lead").size(250).height(20).scale(s.party.colorsStepped).x(20).y(t-70));let i=400,f=t-120;e.append("g").attr("transform",`translate(${i},${f})`).append("g").attr("class","vsup-legend-u").attr("id","diff-u").call(b(s.poc,"% PoC",l)),e.append("g").attr("transform",`translate(${i},${f+20})`).append("g").attr("class","vsup-legend-v").call(F(s.poc)),i=750,f=t-120,e.append("g").attr("transform",`translate(${i},${f})`).append("g").attr("class","vsup-legend-u").call(O(s.population,"assets/human.png","Pop. / Km2")),e.append("g").attr("transform",`translate(${i},${f+55})`).append("g").attr("class","vsup-legend-v").call(U(s.population,"assets/human.png")),e.append("g").attr("transform",`translate(${u-60},${t-80})`).call(A(0,0,50,"rgba(146, 146, 146, 0.5)")).call(function(v){d.current=[v.append("text").attr("x",0).attr("y",8).attr("text-anchor","middle").style("font-weight","bold").style("blend-mode","multiply").text(`${x(".2s")($(p,y.km2))} km²`),v.append("text").attr("x",0).attr("y",55).attr("text-anchor","middle").style("font-size","11px").text(`← ${x(".2s")(C(p,y.km))} km →;`)]})},[]),o.useEffect(()=>{let[r,t]=d.current;r.text(`${x(".2s")($(p,y.km2))} km²`),t.text(`← ${x(".2s")(C(p,y.km))} km →;`)},[p]),n.createElement(n.Fragment,null,n.createElement("svg",{className:"legend-area",ref:c}),n.createElement("div",{className:"study-input"},n.createElement("input",{type:"checkbox",checked:a,onChange:()=>g(r=>!r)}),n.createElement("span",null,"Use VSUP"),n.createElement("input",{type:"checkbox",checked:l,onChange:()=>m(r=>!r)}),n.createElement("span",null,"Show All Rings")))}export{ce as default};
