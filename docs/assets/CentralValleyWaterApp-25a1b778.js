import{r as m,R as a}from"./index-3bff66e1.js";import{s as b,h as L,a as R,b as G,i as A,c as H,d as F,f as y,C as T,e as N,S as P,I as k,M as z,m as V,L as O,q as M}from"./settings-cc329b7d.js";import{W as i,C as B,d as S,u as W,w as U}from"./waterInterps-39213d41.js";import{C as _}from"./groundwaterGeo-4599947a.js";import{u as j}from"./useHexMouseEvts-20f15e41.js";import{u as J}from"./BaseTerrainLayer-87cc4f02.js";import{g as D,a as $,U as v,D as q}from"./overlay-a69705c9.js";import{l as Z,G as K}from"./index-37f17cc4.js";import{s as h}from"./selectAll-e7e2ad64.js";import{S as C,P as X,I as Q,O as Y}from"./SolidHexTileLayer-e7ba2d92.js";import{D as ee}from"./DeagHexTileLayer-991cb9f7.js";import"./scales-7c027d43.js";import"./tile-layer-fb41f257.js";function te({res:s,useVsup:r,setUseVsup:t,showAllRings:o,setShowAllRings:g}){const d=m.useRef(),c=m.useRef();return m.useEffect(()=>{h(".lin-legend").style("visibility",r?"hidden":"visible"),h(".vsup-legend-v").style("visibility",r?"visible":"hidden"),h(".vsup-legend-u").attr("transform",`translate(0,${r?0:50})`),h(".box1").attr("transform",`translate(0,${r?0:150})`).attr("height",r?250:100).attr("width",r?250:300),h(".box2").attr("transform",`translate(0,${r?0:60})`).attr("height",r?170:110)},[r]),m.useEffect(()=>{b("#diff-u").html("").call(L(i.difference,"Diff. w/ BL (600 TAF/km2)",o))},[o]),m.useLayoutEffect(()=>{const n=b(d.current).attr("width",window.innerWidth).attr("height",window.innerHeight),l=200,e=window.innerWidth,p=n.append("g").attr("transform",`translate(0,${window.innerHeight-l})`);p.append("g").attr("transform",`translate(0,${l-250})`).append("rect").attr("class","box1").attr("height",250).attr("width",250).attr("fill","white"),p.append("g").attr("transform",`translate(0,${l-170})`).append("rect").attr("class","box2").attr("height",170).attr("width",920).attr("x",350).attr("fill","white"),p.append("g").attr("class","vsup-legend-v").append("g").call(R().vtitle("GW (ft)").utitle("Variance").scale(i.groundwater.vsup).size(150).x(40).y(l-150-40)),p.append("g").attr("class","lin-legend").append("g").call(Z.simpleLegend(null,250,20,".2s").title("GW (ft)").size(250).height(20).scale(i.groundwater.colorsStepped).x(20).y(l-70));let u=400,f=l-120;p.append("g").attr("transform",`translate(${u},${f})`).append("g").attr("class","vsup-legend-u").attr("id","diff-u").call(L(i.difference,"Diff. w/ BL (600 TAF/km2)",o)),p.append("g").attr("transform",`translate(${u},${f+20})`).append("g").attr("class","vsup-legend-v").call(G(i.difference)),u=750,f=l-120,p.append("g").attr("transform",`translate(${u},${f})`).append("g").attr("class","vsup-legend-u").call(A(i.unmetDemandPositive,"assets/drop.png","Scenario Unmet (600 TAF/km2)")),p.append("g").attr("transform",`translate(${u},${f+55})`).append("g").attr("class","vsup-legend-v").call(H(i.unmetDemandPositive,"assets/drop.png")),p.append("g").attr("transform",`translate(${e-60},${l-80})`).call(F(0,0,50,"rgba(146, 146, 146, 0.5)")).call(function(w){c.current=[w.append("text").attr("x",0).attr("y",8).attr("text-anchor","middle").style("font-weight","bold").style("blend-mode","multiply").text(`${y(".2s")(D(s,v.km2))} km²`),w.append("text").attr("x",0).attr("y",55).attr("text-anchor","middle").style("font-size","11px").text(`← ${y(".2s")($(s,v.km))} km →;`)]})},[]),m.useEffect(()=>{let[n,l]=c.current;n.text(`${y(".2s")(D(s,v.km2))} km²`),l.text(`← ${y(".2s")($(s,v.km))} km →;`)},[s]),a.createElement(a.Fragment,null,a.createElement("svg",{className:"legend-area",ref:d}),a.createElement("div",{className:"study-input"},a.createElement("input",{type:"checkbox",checked:r,onChange:()=>t(n=>!n)}),a.createElement("span",null,"Use VSUP"),a.createElement("input",{type:"checkbox",checked:o,onChange:()=>g(n=>!n)}),a.createElement("span",null,"Show All Rings")))}function ae({speedyCounter:s,setSpeedyCounter:r,playing:t,setPlaying:o,res:g,useVsup:d,setUseVsup:c,showAllRings:n,setShowAllRings:l}){return a.createElement(a.Fragment,null,a.createElement(B,{counter:s,displayMonth:!1,dataset:"averageDemandBaseline"}),a.createElement(te,{res:g,useVsup:d,setUseVsup:c,showAllRings:n,setShowAllRings:l}),a.createElement("div",{className:"styled-input"},a.createElement("button",{onClick:()=>{o(e=>!e)}},t?"Pause":"Play"),a.createElement("input",{onChange:function(e){o(!1),r(parseInt(e.target.value))},onInput:function(e){r(parseInt(e.target.value))},value:s,style:{width:"40vw",display:"block"},type:"range",min:"0",max:"1199",id:"myRange"}),a.createElement("input",{style:{width:"10ch",display:"block"},type:"number",value:s,onChange:function(e){r(parseInt(e.target.value))}})))}const x=P[0];class E extends T{renderLayers(){const{data:r,speedyCounter:t,clickedHexes:o,selectionFinalized:g,visible:d,zoomRange:c,useVsup:n,showAllRings:l}=this.props;return[new C({id:"Groundwater",data:r,thicknessRange:[0,1],getFillColor:e=>n?i.groundwater.interpVsup(e.properties.Groundwater[t],e.properties.GroundwaterVar[t]):i.groundwater.interpColor(e.properties.Groundwater[t]),opacity:1,visible:d,updateTriggers:{getFillColor:[t,n]},zoomRange:c,pickable:!1}),new C({id:"DiffRings",data:r,thicknessRange:[.4,.65],getFillColor:e=>i.difference.interpColor(e.properties.UnmetDemand[x][t]-e.properties.UnmetDemandBaseline[t],!l),getValue:e=>n?i.difference.scaleLinearVar(N(e.properties.UnmetDemandBaselineVar[t],e.properties.UnmetDemandVar[x][t]))*.7+.3:1,visible:d,stroked:!0,extruded:!1,lineJointRounded:!0,getLineColor:[255,255,255,200],getOffset:-.5,extensions:[new X({offset:!0})],opacity:1,updateTriggers:{getFillColor:[t,l],getValue:[t,n]},zoomRange:c,pickable:!1}),new Q({id:"ScenarioUnmet",data:r,loaders:[Y],mesh:"./assets/drop.obj",getColor:e=>[255,130,35,(n?i.unmetDemand.scaleLinearVar(e.properties.UnmetDemandVar[x][t]):1)*200+55],getValue:e=>i.unmetDemand.scaleLinear(e.properties.UnmetDemand[x][t]),visible:d,sizeScale:3e3,opacity:1,updateTriggers:{getTranslation:[t],getColor:[n]},zoomRange:c,pickable:!1}),new ee({...this.props,id:"DeagLayer",data:r,deagData:S,getFillColor:e=>i.unmetDemand.interpColor(e.properties.UnmetDemand[x][t],!1,!1),updateTriggers:{getFillColor:[t]}})]}}E.layerName="MultivariableHextileLayer";E.defaultProps={...T.defaultProps,autoHighlight:!0};const re=Object.keys(U).map(s=>parseInt(s)),I=[7,9];function xe(){const[s,r]=m.useState(k.zoom),t=W(),o=j({dataDeag:S,deagKey:"DURgs"}),g=J(t);return a.createElement(a.Fragment,null,a.createElement(z,{reuseMaps:!0,preventStyleDiffing:!0,mapLib:V,mapStyle:"https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json",antialias:!0,initialViewState:k},a.createElement(q,{getTooltip:g,interleaved:!0,effects:[O],onViewStateChange:({viewState:d})=>{r(d.zoom)}},a.createElement(K,{id:"ground",data:_,stroked:!1,getFillColor:[0,0,0,0],beforeId:"landcover"}),a.createElement(E,{id:"slide-waters",data:U,zoomRange:I,visible:!0,...t,...o,beforeId:"place_hamlet"}))),a.createElement(ae,{res:M().domain(I).range(re)(s),...t}))}export{xe as default};
